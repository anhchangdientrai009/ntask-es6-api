{"version":3,"sources":["../src/db.js"],"names":["db","module","exports","app","config","libs","sequelize","database","username","password","params","Sequelize","models","dir","join","__dirname","readdirSync","forEach","file","modelPath","model","import","name","Object","keys","key","associate"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIA,KAAK,IAAT;;AAEAC,OAAOC,OAAP,GAAiB,UAACC,GAAD,EAAS;AACtB,QAAG,CAACH,EAAJ,EAAO;AACH,YAAMI,SAASD,IAAIE,IAAJ,CAASD,MAAxB;AACA,YAAME,YAAY,wBACdF,OAAOG,QADO,EAEdH,OAAOI,QAFO,EAGdJ,OAAOK,QAHO,EAIdL,OAAOM,MAJO,CAAlB;AAMAV,aAAK;AACDM,gCADC;AAEDK,0CAFC;AAGDC,oBAAQ;AAHP,SAAL;AAKA,YAAMC,MAAM,eAAKC,IAAL,CAAUC,SAAV,EAAqB,QAArB,CAAZ;AACA,qBAAGC,WAAH,CAAeH,GAAf,EAAoBI,OAApB,CAA4B,UAACC,IAAD,EAAU;AAClC,gBAAMC,YAAY,eAAKL,IAAL,CAAUD,GAAV,EAAeK,IAAf,CAAlB;AACA,gBAAME,QAAQd,UAAUe,MAAV,CAAiBF,SAAjB,CAAd;AACAnB,eAAGY,MAAH,CAAUQ,MAAME,IAAhB,IAAwBF,KAAxB;AACH,SAJD;;AAMAG,eAAOC,IAAP,CAAYxB,GAAGY,MAAf,EAAuBK,OAAvB,CAA+B,UAACQ,GAAD,EAAS;AACpCzB,eAAGY,MAAH,CAAUa,GAAV,EAAeC,SAAf,CAAyB1B,GAAGY,MAA5B;AACH,SAFD;AAGH;;AAED,WAAOZ,EAAP;AACH,CA3BD","file":"db.js","sourcesContent":["import fs from \"fs\";\r\nimport path from \"path\";\r\nimport Sequelize from \"sequelize\";\r\n\r\nlet db = null\r\n\r\nmodule.exports = (app) => {    \r\n    if(!db){\r\n        const config = app.libs.config;\r\n        const sequelize = new Sequelize(\r\n            config.database,\r\n            config.username,\r\n            config.password,\r\n            config.params\r\n        );\r\n        db = {\r\n            sequelize,\r\n            Sequelize,\r\n            models: {}        \r\n        }\r\n        const dir = path.join(__dirname, \"models\");\r\n        fs.readdirSync(dir).forEach((file) => {\r\n            const modelPath = path.join(dir, file);\r\n            const model = sequelize.import(modelPath);\r\n            db.models[model.name] = model;\r\n        });\r\n\r\n        Object.keys(db.models).forEach((key) => {\r\n            db.models[key].associate(db.models);\r\n        });\r\n    }\r\n        \r\n    return db;    \r\n};\r\n"]}